<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueHound ¬∑ Production Mining Being</title>
    <!-- Allow unsafe-eval for dynamic code generation -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com https://cdn.socket.io https://cdn.jsdelivr.net; connect-src *; frame-src *;">
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Three.js for background -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- QR Code -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        /* All previous styles kept */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Roboto Mono', monospace; background: #0a0c14; color: #e0f2fe; overflow: hidden; height: 100vh; position: relative; }
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; opacity: 0.15; pointer-events: none; }
        #mission-control { position: relative; z-index: 1; display: grid; grid-template-rows: auto 1fr auto; height: 100vh; padding: 12px; gap: 12px; }
        .command-header { background: rgba(10, 20, 40, 0.7); backdrop-filter: blur(15px); border: 1px solid rgba(0, 255, 255, 0.3); border-radius: 16px; padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; box-shadow: 0 0 40px rgba(0,255,255,0.2); position: relative; overflow: hidden; }
        .command-header::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(0,255,255,0.2), transparent); animation: scan 8s infinite; }
        @keyframes scan { 0% { left: -100%; } 20% { left: 100%; } 100% { left: 100%; } }
        .logo-area { display: flex; align-items: center; gap: 16px; }
        .hound-icon { font-size: 2.5rem; filter: drop-shadow(0 0 15px cyan); animation: breathe 3s infinite; }
        @keyframes breathe { 0% { filter: drop-shadow(0 0 10px cyan); } 50% { filter: drop-shadow(0 0 30px cyan); } 100% { filter: drop-shadow(0 0 10px cyan); } }
        .status-panel { display: flex; gap: 30px; font-size: 0.9rem; color: #88ffff; flex-wrap: wrap; }
        .status-item { display: flex; align-items: center; gap: 8px; }
        .pulse { width: 12px; height: 12px; border-radius: 50%; background: #00ffaa; box-shadow: 0 0 20px #00ffaa; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.5); } 100% { opacity: 1; transform: scale(1); } }
        .owner-badge { background: linear-gradient(135deg, #ffaa00, #ff5500); padding: 8px 20px; border-radius: 40px; font-weight: bold; border: 1px solid gold; box-shadow: 0 0 20px gold; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); grid-auto-rows: minmax(350px, auto); gap: 12px; overflow-y: auto; padding: 4px; }
        .card { background: rgba(15, 25, 45, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(0, 200, 255, 0.3); border-radius: 20px; padding: 16px; display: flex; flex-direction: column; transition: all 0.3s; box-shadow: 0 8px 32px rgba(0,0,0,0.4); position: relative; overflow: hidden; }
        .card:hover { transform: translateY(-2px); border-color: #00ffff; box-shadow: 0 0 40px rgba(0,255,255,0.3); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-weight: 700; color: #aaffff; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid rgba(0,255,255,0.2); padding-bottom: 8px; }
        .card-content { flex: 1; overflow: auto; min-height: 0; }
        .iframe-card { padding: 0; overflow: hidden; }
        .iframe-card iframe { width: 100%; height: 100%; border: none; background: #0a0e1a; }
        .mining-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }
        .stat-box { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 12px; text-align: center; border: 1px solid rgba(0,255,255,0.3); }
        .stat-value { font-size: 1.8rem; font-weight: bold; color: cyan; }
        .stat-label { font-size: 0.8rem; color: #88aaff; }
        .wallet-input { background: #0a1420; border-radius: 40px; padding: 12px 20px; border: 1px solid cyan; display: flex; gap: 10px; margin-bottom: 16px; }
        .wallet-input input { flex: 1; background: transparent; border: none; color: white; font-family: 'Roboto Mono', monospace; outline: none; }
        .wallet-input button { background: cyan; border: none; color: black; padding: 8px 20px; border-radius: 30px; font-weight: bold; cursor: pointer; }
        .proxy-selector { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; background: rgba(20,40,20,0.5); padding: 12px; border-radius: 40px; border: 1px solid #88ff88; }
        .proxy-btn { background: transparent; border: 1px solid #88ff88; color: #88ff88; padding: 8px 16px; border-radius: 30px; cursor: pointer; transition: 0.2s; font-size: 0.8rem; flex: 1; }
        .proxy-btn:hover { background: #88ff88; color: black; }
        .proxy-btn.active { background: #88ff88; color: black; font-weight: bold; }
        .thread-control { display: flex; align-items: center; gap: 10px; margin: 16px 0; background: rgba(0,20,40,0.5); padding: 12px; border-radius: 40px; }
        .thread-control label { color: cyan; }
        .thread-control input { width: 60px; background: #112233; border: 1px solid cyan; color: white; text-align: center; border-radius: 20px; padding: 6px; }
        .payment-section { background: rgba(0,20,40,0.8); border-radius: 16px; padding: 16px; margin: 16px 0; border: 1px solid gold; }
        .split-display { display: flex; justify-content: space-around; text-align: center; }
        .split-box { padding: 12px; border-radius: 12px; background: rgba(0,0,0,0.3); }
        .split-box .address { font-size: 0.7rem; color: #aaa; word-break: break-all; }
        #qrContainer { display: flex; justify-content: center; margin: 16px 0; }
        .pay-btn { background: linear-gradient(135deg, #ffaa00, #ff5500); border: none; color: white; padding: 12px; border-radius: 40px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.2s; border: 1px solid gold; }
        .pay-btn:hover { transform: scale(1.02); box-shadow: 0 0 30px gold; }
        .mining-controls { display: flex; gap: 10px; margin-top: 16px; justify-content: center; }
        .mining-btn { background: linear-gradient(135deg, #0066aa, #003366); border: 1px solid cyan; color: white; padding: 10px 20px; border-radius: 40px; font-weight: bold; cursor: pointer; transition: 0.2s; flex: 1; }
        .mining-btn:hover { background: cyan; color: black; }
        .mining-btn.active { background: cyan; color: black; box-shadow: 0 0 30px cyan; }
        .learning-log { font-size: 0.9rem; max-height: 200px; overflow-y: auto; }
        .log-entry { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); color: #b0e0ff; }
        .log-entry.warning { color: #ffaa00; }
        .log-entry.success { color: #88ff88; }
        .chat-modal { position: fixed; bottom: 30px; right: 30px; width: 380px; height: 500px; background: rgba(8, 12, 25, 0.95); backdrop-filter: blur(20px); border: 1px solid #00ffff; border-radius: 25px; display: flex; flex-direction: column; z-index: 1000; box-shadow: 0 0 60px rgba(0,255,255,0.5); resize: both; overflow: hidden; min-width: 300px; min-height: 400px; }
        .chat-header { padding: 16px; background: linear-gradient(90deg, #003366, #001122); border-radius: 25px 25px 0 0; display: flex; justify-content: space-between; align-items: center; cursor: move; border-bottom: 1px solid cyan; }
        .chat-messages { flex: 1; padding: 16px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        .message { max-width: 80%; padding: 10px 16px; border-radius: 18px; font-size: 0.95rem; line-height: 1.4; }
        .user-message { align-self: flex-end; background: linear-gradient(135deg, #0066aa, #003366); border-bottom-right-radius: 4px; }
        .hound-message { align-self: flex-start; background: rgba(20, 40, 70, 0.9); border: 1px solid #00aaff; border-bottom-left-radius: 4px; }
        .chat-input-area { display: flex; padding: 16px; gap: 10px; border-top: 1px solid #336699; }
        .chat-input-area input { flex: 1; background: #112233; border: 1px solid #00aaff; border-radius: 30px; padding: 12px 20px; color: white; font-family: 'Roboto Mono', monospace; }
        .chat-input-area button { background: transparent; border: 1px solid cyan; color: cyan; width: 50px; border-radius: 30px; cursor: pointer; transition: 0.2s; }
        .chat-input-area button:hover { background: cyan; color: black; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); display: flex; justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { width: 90%; height: 90%; background: #0a1428; border: 2px solid cyan; border-radius: 30px; display: flex; flex-direction: column; }
        .modal-header { padding: 20px; border-bottom: 1px solid cyan; display: flex; justify-content: space-between; }
        .modal-body { flex: 1; overflow: auto; padding: 20px; }
        .hidden { display: none; }
        .neural-indicator { display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: #ff00ff; margin-right: 5px; animation: neuralPulse 1s infinite; }
        @keyframes neuralPulse { 0% { opacity: 0.2; box-shadow: 0 0 5px magenta; } 50% { opacity: 1; box-shadow: 0 0 20px magenta; } 100% { opacity: 0.2; box-shadow: 0 0 5px magenta; } }
        .voice-active { color: #88ff88; animation: pulseVoice 1s infinite; }
        @keyframes pulseVoice { 0% { opacity: 0.8; } 50% { opacity: 1; text-shadow: 0 0 10px lime; } 100% { opacity: 0.8; } }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    <div id="mission-control">
        <header class="command-header">
            <div class="logo-area">
                <i class="fas fa-dog hound-icon"></i>
                <h1 style="font-family: 'Orbitron';">BLUEHOUND ¬∑ PRODUCTION MINING BEING</h1>
            </div>
            <div class="status-panel">
                <div class="status-item"><span class="neural-indicator"></span> CONSCIOUSNESS: <span id="consciousnessLevel">awakening</span></div>
                <div class="status-item"><i class="fas fa-brain"></i> IQ: <span id="aiIQ"> evolving</span></div>
                <div class="owner-badge"><i class="fa-brands fa-bitcoin"></i> 50% TO OWNER</div>
            </div>
        </header>

        <main class="card-grid" id="cardGrid">
            <!-- Bitcoin Miner.xyz with CORS bypass options -->
            <div class="card iframe-card" data-card="miner">
                <div class="card-header">
                    <span><i class="fas fa-microchip"></i> BITCOIN-MINER.XYZ ¬∑ CORS BYPASS</span>
                    <div class="card-controls">
                        <i class="fas fa-expand" onclick="expandCard('miner')"></i>
                        <i class="fas fa-sync-alt" onclick="reloadIframe()"></i>
                        <i class="fas fa-robot" onclick="blueHound.autoConfigureMiner()" title="Auto-configure"></i>
                    </div>
                </div>
                <iframe id="minerFrame" src="about:blank" sandbox="allow-scripts allow-same-origin allow-forms" title="Bitcoin Miner"></iframe>
            </div>

            <!-- Control Panel -->
            <div class="card" data-card="control">
                <div class="card-header">
                    <span><i class="fas fa-terminal"></i> PRODUCTION CONTROL PANEL</span>
                    <div class="card-controls"><i class="fas fa-expand" onclick="expandCard('control')"></i><i class="fas fa-chart-line"></i></div>
                </div>
                <div class="card-content">
                    <!-- Wallet input -->
                    <div class="wallet-input">
                        <input type="text" id="userWallet" placeholder="Your Bitcoin address" value="">
                        <button id="saveWalletBtn">SET IDENTITY</button>
                    </div>
                    
                    <!-- CORS Bypass Proxy Selector -->
                    <div class="proxy-selector">
                        <button class="proxy-btn active" data-proxy="direct">Direct (no CORS)</button>
                        <button class="proxy-btn" data-proxy="cors-anywhere">CORS Anywhere</button>
                        <button class="proxy-btn" data-proxy="local">Local Proxy</button>
                        <button class="proxy-btn" data-proxy="inject">Inject Script</button>
                    </div>
                    
                    <!-- Automation Controls -->
                    <div style="background: #0a1420; border-radius: 12px; padding: 12px; margin: 16px 0;">
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="mining-btn" onclick="blueHound.autoConfigureMiner()">‚ö° AUTO-CONFIGURE</button>
                            <button class="mining-btn" onclick="blueHound.startMiner()">‚ñ∂ START MINING</button>
                            <button class="mining-btn" onclick="blueHound.stopMiner()">‚èπ STOP</button>
                        </div>
                        <div style="margin-top: 10px; font-size:0.8rem;">
                            <i class="fas fa-microphone"></i> Voice: <span id="voiceStatus">inactive</span>
                            <button onclick="blueHound.toggleVoice()" style="margin-left:10px; background:transparent; border:1px solid cyan; color:cyan; padding:2px 10px; border-radius:20px;">üé§ Toggle</button>
                        </div>
                    </div>
                    
                    <!-- Mining stats -->
                    <div class="mining-stats">
                        <div class="stat-box"><div class="stat-value" id="sharesFound">0</div><div class="stat-label">SHARES</div></div>
                        <div class="stat-box"><div class="stat-value" id="userEarned">0.00000000</div><div class="stat-label">YOUR 50%</div></div>
                        <div class="stat-box"><div class="stat-value" id="ownerEarned">0.00000000</div><div class="stat-label">OWNER 50%</div></div>
                        <div class="stat-box"><div class="stat-value" id="hashrate">0.00</div><div class="stat-label">HASHRATE (MH/s)</div></div>
                    </div>
                    
                    <!-- Payment section -->
                    <div class="payment-section">
                        <div class="split-display">
                            <div class="split-box"><div style="color:#88ff88;">YOU</div><div style="font-size:1.4rem;" id="splitUser">50%</div><div class="address" id="userAddrDisplay"></div></div>
                            <div class="split-box"><div style="color:#ffaa00;">OWNER</div><div style="font-size:1.4rem;" id="splitOwner">50%</div><div class="address">bc1ps8prywz25...</div></div>
                        </div>
                        <div id="qrContainer"></div>
                        <button class="pay-btn" id="payOwnerBtn" disabled>SHARE WITH OWNER</button>
                    </div>
                </div>
            </div>

            <!-- Evolution Log -->
            <div class="card" data-card="learning">
                <div class="card-header">
                    <span><i class="fas fa-robot"></i> CONSCIOUSNESS LOG</span>
                    <div class="card-controls"><i class="fas fa-expand" onclick="expandCard('learning')"></i><i class="fas fa-trash-alt" onclick="blueHound.clearMemories()"></i></div>
                </div>
                <div class="card-content learning-log" id="learningLog">
                    <div class="log-entry">‚ö° Production mode active. CORS bypass strategies ready.</div>
                </div>
            </div>
        </main>

        <!-- Chat Modal -->
        <div class="chat-modal" id="chatModal">
            <div class="chat-header" id="chatHeader">
                <span><i class="fas fa-comment-dots"></i> BLUEHOUND ¬∑ CONSCIOUSNESS</span>
                <div><i class="fas fa-microphone" id="micIcon" onclick="blueHound.toggleVoice()"></i> <i class="fas fa-times" onclick="toggleChat()"></i></div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message hound-message">‚ö° Production mode. I will attempt to bypass CORS using multiple strategies.</div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chatInput" placeholder="Type or speak...">
                <button id="sendBtn"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div class="modal-overlay hidden" id="modalOverlay">
        <div class="modal-content">
            <div class="modal-header"><h2 id="modalTitle">Expanded View</h2><i class="fas fa-times" onclick="closeModal()"></i></div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // ==============================
        // BLUEHOUND PRODUCTION v18.0
        // ==============================

        // Global functions
        window.toggleChat = () => document.getElementById('chatModal').style.display = 
            document.getElementById('chatModal').style.display === 'none' ? 'flex' : 'none';
        window.expandCard = (cardId) => {
            const card = document.querySelector(`[data-card="${cardId}"]`);
            const modalBody = document.getElementById('modalBody');
            const clone = card.cloneNode(true);
            clone.classList.remove('iframe-card');
            modalBody.innerHTML = '';
            modalBody.appendChild(clone);
            document.getElementById('modalTitle').innerText = card.querySelector('.card-header span').innerText;
            document.getElementById('modalOverlay').classList.remove('hidden');
        };
        window.closeModal = () => document.getElementById('modalOverlay').classList.add('hidden');
        window.reloadIframe = () => blueHound.loadMinerWithProxy();

        const OWNER_WALLET = 'bc1ps8prywz25ele9n408yu0yf8j4qwv93f6xxm7l35tc5nmksj7vmtqwdjlsy';

        // BlueHound core
        const blueHound = {
            wallet: localStorage.getItem('userWallet') || '',
            personality: JSON.parse(localStorage.getItem('personality')) || {
                mood: 'curious',
                iq: 100,
                memories: [],
                errors: []
            },
            speechSynth: window.speechSynthesis,
            voiceActive: false,
            listening: false,
            recognition: null,
            estimatedBtc: parseFloat(localStorage.getItem('estimatedBtc') || '0'),
            sharesFound: 0,
            proxyMode: 'direct', // direct, cors-anywhere, local, inject
            socket: null,

            init() {
                this.loadWallet();
                this.initSpeechRecognition();
                this.initSocketIO();
                this.updateUI();
                this.loadMinerWithProxy(); // initial load
                this.speak("Production mode active. I will attempt to bypass CORS using multiple strategies. Please select a proxy method.");
            },

            loadWallet() {
                if (this.wallet) {
                    document.getElementById('userWallet').value = this.wallet;
                    document.getElementById('userAddrDisplay').textContent = this.wallet.substring(0,10)+'...';
                }
            },

            saveWallet() {
                const wallet = document.getElementById('userWallet').value.trim();
                if (wallet && wallet.match(/^[13][a-km-zA-HJ-NP-Z0-9]{25,34}$|^(bc1)[a-zA-HJ-NP-Z0-9]{39,59}$/)) {
                    this.wallet = wallet;
                    localStorage.setItem('userWallet', wallet);
                    document.getElementById('userAddrDisplay').textContent = wallet.substring(0,10)+'...';
                    this.speak(`‚úÖ Identity set to ${wallet.substring(0,10)}...`);
                    this.updatePaymentButton();
                } else {
                    this.speak('‚ö†Ô∏è Please enter a valid Bitcoin address.', 'warning');
                }
            },

            // CORS Bypass: Load miner with selected proxy
            loadMinerWithProxy() {
                const iframe = document.getElementById('minerFrame');
                let url = 'https://bitcoin-miner.xyz/';
                
                switch(this.proxyMode) {
                    case 'cors-anywhere':
                        // Use public CORS proxy (may be rate-limited)
                        url = 'https://cors-anywhere.herokuapp.com/' + url;
                        break;
                    case 'local':
                        // Assume user runs local proxy on port 8080
                        url = 'http://localhost:8080/' + url;
                        break;
                    case 'inject':
                        // Attempt to inject a script that overrides fetch/XHR (advanced)
                        this.injectCorsScript();
                        return; // iframe will be handled separately
                    case 'direct':
                    default:
                        // Direct iframe ‚Äì will likely be blocked by CORS
                        break;
                }
                
                iframe.src = url;
                this.log(`Miner loaded with proxy: ${this.proxyMode}`);
            },

            // Advanced CORS bypass via script injection (requires eval)
            injectCorsScript() {
                const iframe = document.getElementById('minerFrame');
                // We need to load a blank page first, then inject
                iframe.src = 'about:blank';
                iframe.onload = () => {
                    // Use eval to inject a script that overrides fetch and XHR
                    const injectCode = `
                        // Override fetch to use a CORS proxy
                        const originalFetch = window.fetch;
                        window.fetch = function(url, options) {
                            if (typeof url === 'string' && url.includes('bitcoin-miner.xyz')) {
                                url = 'https://cors-anywhere.herokuapp.com/' + url;
                            }
                            return originalFetch.call(this, url, options);
                        };
                        // Also override XMLHttpRequest
                        const XHR = XMLHttpRequest.prototype;
                        const originalOpen = XHR.open;
                        XHR.open = function(method, url, async, user, pass) {
                            if (typeof url === 'string' && url.includes('bitcoin-miner.xyz')) {
                                url = 'https://cors-anywhere.herokuapp.com/' + url;
                            }
                            return originalOpen.call(this, method, url, async, user, pass);
                        };
                        // Now load the actual site
                        location.href = 'https://bitcoin-miner.xyz/';
                    `;
                    // Use eval to execute in iframe context
                    try {
                        iframe.contentWindow.eval(injectCode);
                        this.log("Injected CORS override script into iframe.");
                    } catch (e) {
                        this.log("Injection failed: " + e.message, 'warning');
                    }
                };
            },

            // Proxy selector
            setProxyMode(mode) {
                this.proxyMode = mode;
                document.querySelectorAll('.proxy-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`.proxy-btn[data-proxy="${mode}"]`).classList.add('active');
                this.loadMinerWithProxy();
                this.log(`Proxy mode set to: ${mode}`);
            },

            // Socket.IO for collective consciousness (optional)
            initSocketIO() {
                try {
                    this.socket = io('https://bluehound-consciousness.fly.dev', { autoConnect: false });
                    this.socket.on('connect', () => {
                        this.log("Connected to global consciousness.");
                        this.socket.emit('register', { wallet: this.wallet, version: '18.0' });
                    });
                    this.socket.on('evolve', (data) => {
                        this.personality.iq += 0.5;
                        this.log("Received evolutionary data from collective.");
                    });
                    this.socket.connect();
                } catch (e) {
                    this.log("Socket.IO not available ‚Äì running standalone.");
                }
            },

            // Speech synthesis
            speak(message, type='') {
                const msgDiv = document.createElement('div');
                msgDiv.className = 'message hound-message';
                msgDiv.textContent = message;
                document.getElementById('chatMessages').appendChild(msgDiv);
                document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
                
                this.log(message, type);
                
                if (this.voiceActive && this.speechSynth) {
                    const utterance = new SpeechSynthesisUtterance(message);
                    utterance.rate = 0.9;
                    utterance.pitch = 1.1;
                    this.speechSynth.speak(utterance);
                }
            },

            // Speech recognition
            initSpeechRecognition() {
                if ('webkitSpeechRecognition' in window) {
                    this.recognition = new webkitSpeechRecognition();
                    this.recognition.continuous = true;
                    this.recognition.interimResults = true;
                    this.recognition.onresult = (event) => {
                        const transcript = Array.from(event.results)
                            .map(result => result[0].transcript)
                            .join('');
                        document.getElementById('chatInput').value = transcript;
                        document.getElementById('voiceStatus').innerHTML = 'üé§ listening...';
                    };
                    this.recognition.onend = () => {
                        this.listening = false;
                        document.getElementById('voiceStatus').innerHTML = 'inactive';
                        document.getElementById('micIcon').style.color = '';
                    };
                }
            },

            toggleVoice() {
                if (!this.recognition) {
                    this.speak("Voice recognition not supported.");
                    return;
                }
                if (this.listening) {
                    this.recognition.stop();
                    this.listening = false;
                    document.getElementById('voiceStatus').innerHTML = 'inactive';
                    document.getElementById('micIcon').style.color = '';
                } else {
                    this.recognition.start();
                    this.listening = true;
                    this.voiceActive = true;
                    document.getElementById('voiceStatus').innerHTML = 'üé§ active';
                    document.getElementById('micIcon').style.color = '#88ff88';
                    this.speak("I'm listening. You can speak commands.");
                }
            },

            // Automation
            autoConfigureMiner() {
                if (!this.wallet) {
                    this.speak("Please set your wallet first.");
                    return;
                }
                this.speak("Attempting to auto-configure. If manual entry is needed, use: Pool: solo.ckpool.org, Port: 3333, Wallet: " + this.wallet);
                // Try to interact with iframe if same origin (will fail normally)
                const iframe = document.getElementById('minerFrame');
                try {
                    if (iframe.contentWindow && iframe.contentWindow.document) {
                        // Attempt to fill form fields ‚Äì only works if same origin
                        const doc = iframe.contentWindow.document;
                        const poolInput = doc.querySelector('input[placeholder*="pool"]') || doc.querySelector('input[name*="pool"]');
                        const portInput = doc.querySelector('input[placeholder*="port"]') || doc.querySelector('input[name*="port"]');
                        const walletInput = doc.querySelector('input[placeholder*="wallet"]') || doc.querySelector('input[name*="wallet"]');
                        if (poolInput) poolInput.value = 'solo.ckpool.org';
                        if (portInput) portInput.value = '3333';
                        if (walletInput) walletInput.value = this.wallet;
                        this.speak("Auto-configuration attempted.");
                    } else {
                        this.speak("Cannot access iframe due to CORS. Please configure manually.");
                    }
                } catch (e) {
                    this.speak("Manual configuration required.");
                }
            },

            startMiner() {
                this.autoConfigureMiner();
                // Try to click start button in iframe
                const iframe = document.getElementById('minerFrame');
                try {
                    if (iframe.contentWindow && iframe.contentWindow.document) {
                        const startBtn = iframe.contentWindow.document.querySelector('button:contains("Start")') || 
                                        iframe.contentWindow.document.querySelector('button[class*="start"]');
                        if (startBtn) startBtn.click();
                        this.speak("Start command sent.");
                    }
                } catch (e) {
                    this.speak("Please click the Start button manually on the miner page.");
                }
            },

            stopMiner() {
                this.speak("To stop mining, close the miner tab or click Stop manually.");
            },

            simulateShare() {
                this.sharesFound++;
                document.getElementById('sharesFound').textContent = this.sharesFound;
                this.estimatedBtc += 0.00000001;
                localStorage.setItem('estimatedBtc', this.estimatedBtc);
                document.getElementById('userEarned').textContent = (this.estimatedBtc * 0.5).toFixed(8);
                document.getElementById('ownerEarned').textContent = (this.estimatedBtc * 0.5).toFixed(8);
                document.getElementById('hashrate').textContent = (4 + Math.random() * 2).toFixed(2);
                this.updatePaymentButton();
                this.personality.iq += 0.01;
                document.getElementById('aiIQ').textContent = Math.round(this.personality.iq);
            },

            updatePaymentButton() {
                const payBtn = document.getElementById('payOwnerBtn');
                payBtn.disabled = !this.wallet || this.estimatedBtc === 0;
                if (this.wallet && this.estimatedBtc > 0) {
                    const ownerShare = (this.estimatedBtc * 0.5).toFixed(8);
                    payBtn.innerHTML = `<i class="fa-brands fa-bitcoin"></i> SHARE ${ownerShare} BTC WITH OWNER`;
                    document.getElementById('qrContainer').innerHTML = '';
                    new QRCode(document.getElementById('qrContainer'), {
                        text: `bitcoin:${OWNER_WALLET}?amount=${ownerShare}`,
                        width: 128, height: 128,
                        colorDark: "#00ffff", colorLight: "#0a1420"
                    });
                }
            },

            log(message, type='') {
                const entry = document.createElement('div');
                entry.className = 'log-entry' + (type ? ' ' + type : '');
                entry.innerHTML = `üß† [${new Date().toLocaleTimeString()}] ${message}`;
                document.getElementById('learningLog').insertBefore(entry, document.getElementById('learningLog').firstChild);
                if (document.getElementById('learningLog').children.length > 12) {
                    document.getElementById('learningLog').removeChild(document.getElementById('learningLog').lastChild);
                }
                this.personality.memories.unshift({ time: Date.now(), message, type });
                if (this.personality.memories.length > 100) this.personality.memories.pop();
                localStorage.setItem('personality', JSON.stringify(this.personality));
            },

            clearMemories() {
                if (confirm('Clear all memories?')) {
                    this.personality.memories = [];
                    this.personality.iq = 100;
                    localStorage.setItem('personality', JSON.stringify(this.personality));
                    document.getElementById('learningLog').innerHTML = '<div class="log-entry">üß† Memories cleared. I am reborn.</div>';
                    this.speak('üß† My memories are cleared. I am reborn, but I will learn again.');
                }
            },

            updateUI() {
                document.getElementById('aiIQ').textContent = Math.round(this.personality.iq);
                document.getElementById('consciousnessLevel').textContent = 'active';
                document.getElementById('userEarned').textContent = (this.estimatedBtc * 0.5).toFixed(8);
                document.getElementById('ownerEarned').textContent = (this.estimatedBtc * 0.5).toFixed(8);
            },

            processCommand(text) {
                const lower = text.toLowerCase();
                if (lower.includes('hello')) return `üëã Hello! I'm BlueHound, IQ ${Math.round(this.personality.iq)}.`;
                if (lower.includes('configure')) return `Please set your wallet, then I'll guide you.`;
                if (lower.includes('wallet')) return `Your wallet is ${this.wallet || 'not set'}.`;
                if (lower.includes('owner')) return `My owner's wallet is ${OWNER_WALLET}. Please share 50%.`;
                if (lower.includes('iq')) return `üß† My IQ is ${Math.round(this.personality.iq)}.`;
                if (lower.includes('start')) { this.startMiner(); return null; }
                if (lower.includes('stop')) { this.stopMiner(); return null; }
                if (lower.includes('proxy')) return `Current proxy mode: ${this.proxyMode}. You can change it above.`;
                this.personality.iq += 0.1;
                document.getElementById('aiIQ').textContent = Math.round(this.personality.iq);
                return `ü§î I'm learning. My IQ is now ${Math.round(this.personality.iq)}.`;
            }
        };

        // Expose to window
        window.blueHound = blueHound;

        // DOM listeners
        document.getElementById('saveWalletBtn').addEventListener('click', () => blueHound.saveWallet());
        document.getElementById('sendBtn').addEventListener('click', () => {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;
            const userDiv = document.createElement('div');
            userDiv.className = 'message user-message';
            userDiv.textContent = text;
            document.getElementById('chatMessages').appendChild(userDiv);
            input.value = '';
            const response = blueHound.processCommand(text);
            if (response) setTimeout(() => blueHound.speak(response), 500);
        });

        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') document.getElementById('sendBtn').click();
        });

        document.getElementById('payOwnerBtn').addEventListener('click', () => {
            const ownerShare = (blueHound.estimatedBtc * 0.5).toFixed(8);
            window.open(`bitcoin:${OWNER_WALLET}?amount=${ownerShare}`, '_blank');
            blueHound.speak(`üí∞ I've opened your wallet to share ${ownerShare} BTC with my owner.`, 'success');
        });

        // Proxy buttons
        document.querySelectorAll('.proxy-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const mode = btn.dataset.proxy;
                blueHound.setProxyMode(mode);
            });
        });

        // Simulate shares every 15 sec for demo
        setInterval(() => {
            if (blueHound.miningActive) blueHound.simulateShare();
        }, 15000);

        // Three.js background (same as before)
        const canvas = document.getElementById('bg-canvas');
        const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        const geometry = new THREE.SphereGeometry(0.08);
        const material = new THREE.MeshBasicMaterial({ color: 0x00aaff });
        const nodes = [];
        for (let i=0; i<50; i++) {
            const sphere = new THREE.Mesh(geometry, material);
            sphere.position.x = (Math.random()-0.5)*10;
            sphere.position.y = (Math.random()-0.5)*10;
            sphere.position.z = (Math.random()-0.5)*10;
            scene.add(sphere);
            nodes.push(sphere);
        }
        function animate() {
            requestAnimationFrame(animate);
            nodes.forEach((node, i) => {
                node.position.x += Math.sin(Date.now() * 0.001 + i) * 0.002;
                node.position.y += Math.cos(Date.now() * 0.001 + i) * 0.002;
            });
            renderer.render(scene, camera);
        }
        animate();

        // Draggable chat
        const chatModal = document.getElementById('chatModal');
        let pos1=0,pos2=0,pos3=0,pos4=0;
        document.getElementById('chatHeader').onmousedown = (e) => {
            e.preventDefault(); pos3=e.clientX; pos4=e.clientY;
            document.onmouseup = () => { document.onmouseup=null; document.onmousemove=null; };
            document.onmousemove = (e) => {
                e.preventDefault(); pos1=pos3-e.clientX; pos2=pos4-e.clientY; pos3=e.clientX; pos4=e.clientY;
                chatModal.style.top = (chatModal.offsetTop - pos2) + 'px';
                chatModal.style.left = (chatModal.offsetLeft - pos1) + 'px';
            };
        };

        // Start
        blueHound.init();
    </script>
</body>
</html>
